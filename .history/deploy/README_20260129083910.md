# VPS Deployment Guide

## Quick Start

### 1. Update Variables
Edit `setup-vps.sh`:
```bash
DOMAIN="your-domain.com"  # Your actual domain
```

Edit `sync-to-vps.sh`:
```bash
VPS_IP="123.456.789.0"    # Your VPS IP
VPS_USER="root"            # SSH user
```

---

### 2. First Time Setup (on VPS)
```bash
# Upload setup script
scp setup-vps.sh root@YOUR_VPS_IP:/root/

# SSH to VPS and run
ssh root@YOUR_VPS_IP
chmod +x setup-vps.sh
./setup-vps.sh
```

---

### 3. Deploy Code (from local)
```bash
cd deploy
bash sync-to-vps.sh
```

---

### 4. Configure Backend (on VPS)
```bash
cd /var/www/defenseprotocol/backend
cp .env.example .env
nano .env
```

Update these values:
```env
APP_ENV=production
APP_DEBUG=false
APP_URL=https://your-domain.com

DB_DATABASE=defense_db
DB_USERNAME=defense_user
DB_PASSWORD=<from setup output>

SOLANA_NETWORK=mainnet-beta
SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
```

---

### 5. Build & Migrate
```bash
# Backend
cd /var/www/defenseprotocol/backend
composer install --no-dev --optimize-autoloader
php artisan key:generate
php artisan migrate --force
php artisan config:cache
php artisan route:cache

# Frontend
cd /var/www/defenseprotocol/frontend
npm install
npm run build

# Start backend
systemctl start defense-backend
systemctl status defense-backend
```

---

### 6. SSL Certificate
```bash
certbot --nginx -d your-domain.com
```

---

### 7. Build Smart Contract (on VPS)
```bash
cd /var/www/defenseprotocol/mission_lock
anchor build
anchor deploy --provider.cluster devnet
```

---

## Troubleshooting

| Issue | Solution |
|-------|----------|
| 502 Bad Gateway | `systemctl restart defense-backend` |
| Permission denied | `chown -R www-data:www-data /var/www/defenseprotocol` |
| Laravel logs | `tail -f /var/www/defenseprotocol/backend/storage/logs/laravel.log` |
| Nginx logs | `tail -f /var/log/nginx/error.log` |
